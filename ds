#!/bin/bash
# DeepStream containers only (no frpc)

case "$1" in
    build)
        ./build.sh
        ;;
    start)
        # Start s1 (bowling ball detection)
        docker run -d --name ds-s1 --gpus all --net=host \
          -v /root/d_final/config:/config \
          -v /root/d_final/models:/models \
          ds-s1:latest /app/live_stream 1 portrait /config/s1_bowling_ball_640.txt

        # Start s2 (same as s1 for testing)
        docker run -d --name ds-s2 --gpus all --net=host \
          -v /root/d_final/config:/config \
          -v /root/d_final/models:/models \
          ds-s1:latest /app/live_stream 2 portrait /config/s2_bowling_ball_640.txt

        # Start s3 (YOLO11x COCO FP32)
        docker run -d --name ds-s3 --gpus all --net=host \
          -v /root/d_final/config:/config \
          -v /root/d_final/models:/models \
          ds-s1:latest /app/live_stream 3 portrait /config/s3_yolo11x_1280.txt

        echo "✓ DeepStream containers started (s1: ball only, s2: COCO only, s3: COCO+ball SGIE+tracker)"
        ;;
    stop)
        docker stop ds-s1 ds-s2 ds-s3 2>/dev/null
        docker rm ds-s1 ds-s2 ds-s3 2>/dev/null
        echo "✓ DeepStream containers stopped"
        ;;
    restart)
        # Restart all
        $0 stop && $0 start
        ;;
    status)
        docker ps --filter "name=ds-" --format "table {{.Names}}\t{{.Status}}"
        ;;
    *)
        echo "Usage: $0 {build|start|stop|restart|status}"
        exit 1
        ;;
esac
