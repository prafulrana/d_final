#!/bin/bash
# DeepStream containers only (no frpc)

case "$1" in
    build)
        ./build.sh
        ;;
    start)
        # Start s0 (Dual inference: YOLO12m pins + bowling ball)
        docker run -d --name ds-s0 --gpus all --net=host \
          -v /root/d_final/config:/config \
          -v /root/d_final/models:/models \
          ds-s1:latest /app/live_stream_dual_infer 0 portrait

        # Start s1 (Dual inference: YOLO12m pins + bowling ball)
        docker run -d --name ds-s1 --gpus all --net=host \
          -v /root/d_final/config:/config \
          -v /root/d_final/models:/models \
          ds-s1:latest /app/live_stream_dual_infer 1 portrait

        # Start s2 (Dual inference: YOLO12m pins + bowling ball)
        docker run -d --name ds-s2 --gpus all --net=host \
          -v /root/d_final/config:/config \
          -v /root/d_final/models:/models \
          ds-s1:latest /app/live_stream_dual_infer 2 portrait

        # Start s3 (Dual inference: YOLO12m pins + bowling ball)
        docker run -d --name ds-s3 --gpus all --net=host \
          -v /root/d_final/config:/config \
          -v /root/d_final/models:/models \
          ds-s1:latest /app/live_stream_dual_infer 3 portrait

        echo "✓ DeepStream containers started (All: YOLO12m pins + bowling ball detection)"
        ;;
    stop)
        docker stop ds-s0 ds-s1 ds-s2 ds-s3 2>/dev/null
        docker rm ds-s0 ds-s1 ds-s2 ds-s3 2>/dev/null
        echo "✓ DeepStream containers stopped"
        ;;
    restart)
        # Restart all
        $0 stop && $0 start
        ;;
    status)
        docker ps --filter "name=ds-" --format "table {{.Names}}\t{{.Status}}"
        ;;
    *)
        echo "Usage: $0 {build|start|stop|restart|status}"
        exit 1
        ;;
esac
