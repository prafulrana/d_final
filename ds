#!/bin/bash
# DeepStream containers only (no frpc)

case "$1" in
    build)
        ./build.sh
        ;;
    start)
        docker run -d --name ds-s0 --gpus all --net=host \
          -v /root/d_final/config:/config \
          -v /root/d_final/models:/models \
          ds-s1:latest /app/live_stream 0 portrait

        docker run -d --name ds-s1 --gpus all --net=host \
          -v /root/d_final/config:/config \
          -v /root/d_final/models:/models \
          ds-s1:latest /app/live_stream 1 portrait

        docker run -d --name ds-s2 --gpus all --net=host \
          -v /root/d_final/config:/config \
          -v /root/d_final/models:/models \
          ds-s1:latest /app/live_stream 2 portrait /config/config_infer_bowling_640.txt

        docker run -d --name ds-s3 --gpus all --net=host \
          -v /root/d_final/config:/config \
          -v /root/d_final/models:/models \
          ds-s1:latest /app/live_stream 3 portrait /config/config_infer_bowling.txt

        echo "✓ DeepStream containers started (s0-s1: COCO, s2: bowling 640, s3: bowling 1280)"
        ;;
    stop)
        docker stop ds-s0 ds-s1 ds-s2 ds-s3 2>/dev/null
        docker rm ds-s0 ds-s1 ds-s2 ds-s3 2>/dev/null
        echo "✓ DeepStream containers stopped"
        ;;
    restart)
        $0 stop && $0 start
        ;;
    status)
        docker ps --filter "name=ds-s" --format "table {{.Names}}\t{{.Status}}"
        ;;
    *)
        echo "Usage: $0 {build|start|stop|restart|status}"
        exit 1
        ;;
esac
